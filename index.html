<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emscripten</title>
</head>

<body>
  <script src="./hello.js" type="text/javascript"></script>
  <!-- <script src="./hello2.wasm"></script> -->
  <script>
    // 加载 wasm 模块
    (async function fetchAndInstantiate() {
      const response = await fetch("hello3.wasm");
      console.log(response)
      const buffer = await response.arrayBuffer();
      console.log(buffer, typeof buffer)
      const obj = await WebAssembly.instantiate(buffer, {});
      console.log(obj)
      console.log(obj.instance.exports.add(1, 2));  // "3"
    } )()
    // fetch('http://localhost:4000/hello2.wasm')
    //   .then(response => {
    //     console.log(response)
    //     response.arrayBuffer()
    //   })
    //   .then(bytes => {
    //     console.log(bytes)
    //     WebAssembly.instantiate(bytes)
    //   })
      // .then(results => {
      //   // 调用 wasm 模块中的函数将其实例化
      //   console.log(results)
      //   const { add } = results.instance.exports;
      //   console.log(add(1, 2)); // 输出 3
      // });
  </script>
  </script>
  <script>
    // (async () => {
    //     const config = {
    //       env: {
    //         memoryBase: 0,
    //         tableBase: 0,
    //         memory: new WebAssembly.Memory({
    //           initial: 256,
    //         }),
    //         table: new WebAssembly.Table({
    //           initial: 0,
    //           element: 'anyfunc',
    //         }),
    //       }
    //     }
    //     const fetchPromise = fetch('hello3.wasm');
    //     console.log(fetchPromise)
    //     const { instance } = await WebAssembly.instantiateStreaming(fetchPromise, config);
    //     console.log(instance)
    //     const result = instance.exports._add(1, 2);
    //     console.log(result);
    //   })()
  </script>
</body>

</html>